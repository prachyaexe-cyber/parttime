<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>บันทึกเวลาทำงาน & OT</title>
<style>
body { font-family: Tahoma; padding: 20px; max-width: 850px; margin:auto; }
input { padding: 6px; margin: 4px 0; font-size: 16px; }
label { font-weight: bold; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #666; padding: 6px; text-align: center; }
.summary { margin-top: 15px; padding: 12px; background:#f2f2f2; font-size:18px; }
.form-row { display:flex; gap:15px; flex-wrap:wrap; }
.form-row div { flex:1; min-width:160px; }
button { padding: 8px 14px; font-size: 16px; margin-top: 10px; cursor: pointer; }
</style>
</head>
<body>

<h2>ระบบบันทึกเวลาทำงาน & คำนวณ OT</h2>

<div class="form-row">
  <div>
    <label>วันที่</label><br>
    <input type="date" id="date">
  </div>
  <div>
    <label>เวลาเข้า</label><br>
    <input type="text" id="start" placeholder="09:00" oninput="autoTimeFormat(this)">
  </div>
  <div>
    <label>เวลาออก</label><br>
    <input type="text" id="end" placeholder="17:00" oninput="autoTimeFormat(this)">
  </div>
</div>

<button onclick="addWork()">บันทึกข้อมูล</button>

<table id="workTable">
  <thead>
    <tr>
      <th>ลำดับ</th>
      <th>วันที่</th>
      <th>เวลาเข้า</th>
      <th>เวลาออก</th>
      <th>OT (ชม.)</th>
      <th>รวมเงิน (฿)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="summary" id="summary"></div>

<button onclick="exportExcel()">ดาวน์โหลด Excel</button>

<script>
let record = [];
const dayHours = 8;            // เวลาคิดเงินหลังหักพัก
const dayPay = 500;            // ค่าจ้างต่อวัน
const otRate = (dayPay / dayHours) * 1.5; // ค่าชั่วโมง OT
const breakHours = 1;          // หักพักอัตโนมัติ

function autoTimeFormat(i){
  let v = i.value.replace(/[^0-9]/g,"");
  if(v.length >= 3) i.value = v.slice(0,2) + ":" + v.slice(2,4);
}

function timeToHours(t){
  let [h,m] = t.split(":").map(Number);
  return h + (m/60);
}

function addWork(){
  let date = dateField.value;
  let start = startField.value;
  let end = endField.value;
  if(!date || start.length !== 5 || end.length !== 5)
    return alert("กรุณากรอกวันที่และเวลาให้ครบ เช่น 09:00");

  let hours = timeToHours(end) - timeToHours(start) - breakHours;
  if(hours < 0) return alert("เวลาออกต้องมากกว่าเวลาเข้า");

  let ot = Math.max(0, hours - dayHours);
  let normal = Math.min(hours, dayHours);
  let total = (normal * (dayPay/dayHours)) + (ot * otRate);

  record.push({date, start, end, ot, total});
  renderTable();
}

function renderTable(){
  let tbody = document.querySelector("#workTable tbody");
  tbody.innerHTML = "";
  let totalOT = 0, totalMoney = 0;

  record.forEach((r,i)=>{
    totalOT += r.ot;
    totalMoney += r.total;
    tbody.innerHTML += `<tr>
      <td>${i+1}</td>
      <td>${r.date}</td>
      <td>${r.start}</td>
      <td>${r.end}</td>
      <td>${r.ot.toFixed(2)}</td>
      <td>${r.total.toFixed(2)}</td>
    </tr>`;
  });

  summary.innerHTML =
    `รวมทั้งหมด: <b>${record.length}</b> วัน | OT: <b>${totalOT.toFixed(2)}</b> ชม. | รวมเงิน: <b>${totalMoney.toFixed(2)}</b> บาท`;
}

function exportExcel(){
  let csv = "ลำดับ,วันที่,เวลาเข้า,เวลาออก,OT,รวมเงิน\n";
  record.forEach((r,i)=> csv += `${i+1},${r.date},${r.start},${r.end},${r.ot.toFixed(2)},${r.total.toFixed(2)}\n`);
  let blob = new Blob(["\uFEFF"+csv], {type:"text/csv;charset=utf-8;"});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "work_record.csv";
  link.click();
}

const dateField = document.getElementById("date");
const startField = document.getElementById("start");
const endField = document.getElementById("end");
</script>

</body>
</html>