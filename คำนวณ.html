<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å | Local Storage</title>
    <style>
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dark Theme (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        :root {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --input-bg: #333333;
            --border-color: #444444;
            --primary-color: #4CAF50; 
            --edit-color: #2196F3;
            --delete-color: #f44336;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }

        h2, h3 {
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 20px;
        }

        .input-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        #dateInput { width: 120px; }
        #timeIn, #timeOut { width: 80px; }
        #hourlyRate, #otMultiplier { width: 70px; }
        
        .btn-add {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn-add:hover { background-color: #3e8e41; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #282828;
            color: #ffffff;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #252525;
        }

        .btn-action {
            margin: 2px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            transition: opacity 0.3s;
        }
        .btn-action:hover { opacity: 0.8; }
        .btn-edit { background-color: var(--edit-color); }
        .btn-delete { background-color: var(--delete-color); }

        #summaryContainer {
            font-size: 1.1em;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #282828;
            margin-top: 15px;
        }
        #summaryContainer strong {
            color: var(--primary-color);
        }
    </style>
</head>
<body onload="loadTimeEntries()">
<div class="container">
    <h2>‚è∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</h2>

    <div class="input-group">
        <div class="input-item">
            <label for="dateInput">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="dateInput" required>
        </div>
        <div class="input-item">
            <label for="timeIn">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label>
            <input type="text" id="timeIn" maxlength="5" placeholder="08:30" required>
        </div>
        <div class="input-item">
            <label for="timeOut">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
            <input type="text" id="timeOut" maxlength="5" placeholder="17:30" required>
        </div>
        <div class="input-item">
            <label for="breakTime">‡∏´‡∏±‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
            <select id="breakTime">
                <option value="60">60 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="30">30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="45">45 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="0">0 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
            </select>
        </div>
        <div class="input-item">
            <label for="hourlyRate">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏°.</label>
            <input type="number" id="hourlyRate" value="50" min="1" step="0.01" required>
        </div>
        <div class="input-item">
            <label for="otMultiplier">OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)</label>
            <input type="number" id="otMultiplier" value="1.5" min="1" step="0.1" required>
        </div>
        <button class="btn-add" onclick="addTimeEntry()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <h3>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h3>
    <table>
        <thead>
            <tr>
                <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</th>
                <th>‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å (‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                <th>OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)</th>
                <th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°</th>
                <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody id="timeTableBody">
            </tbody>
    </table>

    <h3 style="margin-top: 30px;">
        üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </h3>
    <div id="summaryContainer">
        </div>

    <button class="btn-add" onclick="exportToCSV()" style="margin-top: 20px;">
        üíæ ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå CSV (‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î)
    </button>
</div>

<script>
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Local Storage)
    let timeEntries = [];
    let currentId = 1;
    const STORAGE_KEY = 'timeTrackerEntries'; // Key ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Local Storage

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Local Storage ---
    function loadTimeEntries() {
        const storedEntries = localStorage.getItem(STORAGE_KEY);
        if (storedEntries) {
            try {
                timeEntries = JSON.parse(storedEntries);
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î currentId ‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ ID ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ ID ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
                if (timeEntries.length > 0) {
                    currentId = Math.max(...timeEntries.map(e => e.id)) + 1;
                }
            } catch (e) {
                console.error("Error loading or parsing data from Local Storage", e);
                timeEntries = [];
            }
        }
        renderTable(); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Local Storage ---
    function saveTimeEntries() {
        // ‡πÅ‡∏õ‡∏•‡∏á Array ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô string ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        localStorage.setItem(STORAGE_KEY, JSON.stringify(timeEntries));
    }


    // --- HELPER FUNCTION: ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° ‡πÄ‡∏õ‡πá‡∏ô "‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏ô‡∏≤‡∏ó‡∏µ" (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ---
    function formatHoursToHHMM(decimalHours) {
        if (decimalHours <= 0) return '0 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 0 ‡∏ô‡∏≤‡∏ó‡∏µ';
        const hours = Math.floor(decimalHours);
        const minutesDecimal = decimalHours - hours;
        const minutes = Math.round(minutesDecimal * 60);

        if (minutes === 60) {
            return `${hours + 1} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 0 ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }
        return `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
    }

    // --- 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ":" ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ---
    function formatTimeInput(event) {
        const input = event.target;
        let value = input.value.replace(/[^0-9]/g, ''); 
        
        if (value.length > 4) { value = value.substring(0, 4); }
        if (value.length >= 2) {
            let hour = parseInt(value.substring(0, 2));
            if (hour > 23) { value = '23' + value.substring(2); }
        }
        if (value.length >= 4) {
            let minute = parseInt(value.substring(2, 4));
            if (minute > 59) { value = value.substring(0, 2) + '59'; }
        }
        if (value.length > 2) {
            value = value.substring(0, 2) + ':' + value.substring(2);
        }
        input.value = value;
    }

    document.getElementById('timeIn').addEventListener('input', formatTimeInput);
    document.getElementById('timeOut').addEventListener('input', formatTimeInput);

    // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ---
    function calculateEarnings(entry) {
        const dateBase = '2000/01/01';
        let timeIn = new Date(`${dateBase} ${entry.timeIn}`);
        let timeOut = new Date(`${dateBase} ${entry.timeOut}`);

        if (timeOut.getTime() <= timeIn.getTime()) {
            timeOut.setDate(timeOut.getDate() + 1);
        }

        const durationMs = timeOut.getTime() - timeIn.getTime();
        let totalMinutes = durationMs / (1000 * 60);

        const workingMinutes = totalMinutes - entry.breakTime;
        const workingHours = Math.max(0, workingMinutes / 60);

        const standardHours = Math.min(workingHours, 8);
        const otHours = Math.max(0, workingHours - 8);

        const standardPay = standardHours * entry.hourlyRate;
        const otPay = otHours * entry.hourlyRate * entry.otMultiplier;
        
        const totalEarnings = standardPay + otPay;

        return {
            workingHours: workingHours,
            totalEarnings: totalEarnings
        };
    }

    // --- 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà ---
    function addTimeEntry() {
        const date = document.getElementById('dateInput').value;
        const timeIn = document.getElementById('timeIn').value;
        const timeOut = document.getElementById('timeOut').value;
        const breakTime = parseInt(document.getElementById('breakTime').value);
        const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
        const otMultiplier = parseFloat(document.getElementById('otMultiplier').value);

        if (!date || timeIn.length !== 5 || timeOut.length !== 5) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤, ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö HH:MM) ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            return;
        }

        const newEntry = {
            id: currentId++,
            date,
            timeIn,
            timeOut,
            breakTime,
            hourlyRate,
            otMultiplier
        };

        timeEntries.push(newEntry);
        renderTable(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderTable ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveTimeEntries
        
        document.getElementById('dateInput').value = '';
        document.getElementById('timeIn').value = '';
        document.getElementById('timeOut').value = '';
    }

    // --- 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Render) ---
    function renderTable() {
        const body = document.getElementById('timeTableBody');
        body.innerHTML = '';
        
        timeEntries.forEach((entry, index) => {
            const result = calculateEarnings(entry);
            const row = body.insertRow();
            
            row.insertCell().textContent = index + 1;
            row.insertCell().textContent = entry.date;
            row.insertCell().textContent = entry.timeIn;
            row.insertCell().textContent = entry.timeOut;
            row.insertCell().textContent = entry.breakTime;
            row.insertCell().textContent = entry.otMultiplier.toFixed(1);
            row.insertCell().textContent = formatHoursToHHMM(result.workingHours); 
            row.insertCell().textContent = result.totalEarnings.toFixed(2);
            
            const actionCell = row.insertCell();
            actionCell.innerHTML = `
                <button class="btn-action btn-edit" onclick="editEntry(${entry.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button class="btn-action btn-delete" onclick="deleteEntry(${entry.id})">‡∏•‡∏ö</button>
            `;
        });
        
        updateSummary();
        saveTimeEntries(); // **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ñ‡∏π‡∏Å Render**
    }

    // --- 5. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ---
    function deleteEntry(id) {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
            timeEntries = timeEntries.filter(entry => entry.id !== id);
            renderTable(); // ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveTimeEntries
        }
    }

    // --- 6. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÉ‡∏ä‡πâ Prompt) ---
    function editEntry(id) {
        const entry = timeEntries.find(e => e.id === id);
        if (!entry) return;

        const newDate = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:`, entry.date);
        const newTimeIn = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ (HH:MM):`, entry.timeIn);
        const newTimeOut = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å (HH:MM):`, entry.timeOut);
        const newBreak = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏´‡∏±‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å (‡∏ô‡∏≤‡∏ó‡∏µ):`, entry.breakTime);
        const newRate = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏°.:`, entry.hourlyRate);
        const newOT = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì):`, entry.otMultiplier);

        if (newDate && newTimeIn && newTimeOut && newBreak !== null && newRate && newOT) {
             entry.date = newDate;
             entry.timeIn = newTimeIn;
             entry.timeOut = newTimeOut;
             entry.breakTime = parseInt(newBreak) || 0;
             entry.hourlyRate = parseFloat(newRate) || entry.hourlyRate;
             entry.otMultiplier = parseFloat(newOT) || entry.otMultiplier;

            renderTable(); // ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveTimeEntries
        }
    }
    
    // --- 7. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°) ---
    function updateSummary() {
        let totalHours = 0;
        let totalEarnings = 0;
        const uniqueDates = new Set(); 

        timeEntries.forEach(entry => {
            const result = calculateEarnings(entry);
            totalHours += result.workingHours;
            totalEarnings += result.totalEarnings;
            uniqueDates.add(entry.date); 
        });

        const totalDays = uniqueDates.size;
        const formattedTotalHours = formatHoursToHHMM(totalHours); 

        const summaryDiv = document.getElementById('summaryContainer');
        summaryDiv.innerHTML = `
            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ${totalDays} ‡∏ß‡∏±‡∏ô</p>
            <p><strong>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${formattedTotalHours}</p>
            <p><strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${totalEarnings.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
        `;
    }

    // --- 8. Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ---
    function exportToCSV() {
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; 
        let header = ["‡∏•‡∏≥‡∏î‡∏±‡∏ö", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤", "‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å", "OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)", "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)"];
        csvContent += header.join(",") + "\n";

        timeEntries.forEach((entry, index) => {
            const result = calculateEarnings(entry);
            let row = [
                index + 1,
                entry.date,
                entry.timeIn,
                entry.timeOut,
                entry.otMultiplier.toFixed(1),
                result.totalEarnings.toFixed(2)
            ];
            csvContent += row.join(",") + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "time_log_" + new Date().toISOString().slice(0, 10) + ".csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
