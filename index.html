<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å | Time Tracker</title>
    <style>
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ */
        #dateInput { width: 120px; } 
        /* ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
        .input-group input, .input-group select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px; }
        .input-group { display: flex; flex-wrap: wrap; margin-bottom: 20px; align-items: flex-end; }
        .input-item { margin-right: 15px; margin-bottom: 10px; }
        .input-item label { display: block; margin-bottom: 5px; font-weight: bold; }
        .btn-add { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        .btn-add:hover { background-color: #45a049; }
        
        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; color: #333; }
        .btn-action { margin: 2px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; }
        .btn-edit { background-color: #2196F3; }
        .btn-delete { background-color: #f44336; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</h2>

    <div class="input-group">
        <div class="input-item">
            <label for="dateInput">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="dateInput" required>
        </div>
        <div class="input-item">
            <label for="timeIn">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label>
            <input type="text" id="timeIn" maxlength="5" placeholder="08:30" required>
        </div>
        <div class="input-item">
            <label for="timeOut">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
            <input type="text" id="timeOut" maxlength="5" placeholder="17:30" required>
        </div>
        <div class="input-item">
            <label for="breakTime">‡∏´‡∏±‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
            <select id="breakTime">
                <option value="60">60 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="30">30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="45">45 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="0">0 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
            </select>
        </div>
        <div class="input-item">
            <label for="hourlyRate">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏°.</label>
            <input type="number" id="hourlyRate" value="50" min="0" required>
        </div>
        <div class="input-item">
            <label for="otMultiplier">OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)</label>
            <input type="number" id="otMultiplier" value="1.5" step="0.1" min="1" required>
        </div>
        <button class="btn-add" onclick="addTimeEntry()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <hr>
    
    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h3>
    <table>
        <thead>
            <tr>
                <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</th>
                <th>‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å (‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                <th>OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)</th>
                <th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°</th>
                <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody id="timeTableBody">
            </tbody>
    </table>

    <button class="btn-add" onclick="exportToCSV()" style="margin-top: 20px;">
        üíæ ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå CSV
    </button>
</div>

<script>
    // JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    let timeEntries = [];
    let currentId = 1;

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 1: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ":" ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---
    function formatTimeInput(event) {
        const input = event.target;
        let value = input.value.replace(/:/g, ''); // ‡∏•‡∏ö ":" ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å
        
        if (value.length > 2) {
            value = value.substring(0, 2) + ':' + value.substring(2);
        }
        
        if (value.length > 5) { // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô HH:MM
            value = value.substring(0, 5);
        }
        input.value = value;
    }

    document.getElementById('timeIn').addEventListener('input', formatTimeInput);
    document.getElementById('timeOut').addEventListener('input', formatTimeInput);

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 2: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ---
    function calculateEarnings(entry) {
        const timeIn = new Date(`2000/01/01 ${entry.timeIn}`);
        const timeOut = new Date(`2000/01/01 ${entry.timeOut}`);
        const breakMs = entry.breakTime * 60 * 1000;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ)
        let totalMinutes = (timeOut - timeIn) / (1000 * 60);

        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô (‡∏´‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤) ‡πÉ‡∏´‡πâ‡∏ö‡∏ß‡∏Å‡πÑ‡∏õ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
        if (totalMinutes < 0) {
            totalMinutes += 24 * 60;
        }

        const workingMinutes = totalMinutes - entry.breakTime;
        const workingHours = workingMinutes / 60;

        // ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ < 8 ‡∏ä‡∏°. ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô OT)
        const standardHours = Math.min(workingHours, 8);
        const otHours = Math.max(0, workingHours - 8);

        const standardPay = standardHours * entry.hourlyRate;
        const otPay = otHours * entry.hourlyRate * entry.otMultiplier;
        
        const totalEarnings = standardPay + otPay;

        return {
            workingHours: workingHours.toFixed(2),
            totalEarnings: totalEarnings.toFixed(2)
        };
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 3: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà ---
    function addTimeEntry() {
        const date = document.getElementById('dateInput').value;
        const timeIn = document.getElementById('timeIn').value;
        const timeOut = document.getElementById('timeOut').value;
        const breakTime = parseInt(document.getElementById('breakTime').value);
        const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
        const otMultiplier = parseFloat(document.getElementById('otMultiplier').value);

        if (!date || !timeIn || !timeOut) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤, ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            return;
        }

        const newEntry = {
            id: currentId++,
            date,
            timeIn,
            timeOut,
            breakTime,
            hourlyRate,
            otMultiplier
        };

        timeEntries.push(newEntry);
        renderTable();
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Rate/OT
        document.getElementById('dateInput').value = '';
        document.getElementById('timeIn').value = '';
        document.getElementById('timeOut').value = '';
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 4: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Render) ---
    function renderTable() {
        const body = document.getElementById('timeTableBody');
        body.innerHTML = '';
        
        timeEntries.forEach((entry, index) => {
            const result = calculateEarnings(entry);
            const row = body.insertRow();
            row.id = `row-${entry.id}`;

            row.insertCell().textContent = index + 1; // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà
            row.insertCell().textContent = entry.date;
            row.insertCell().textContent = entry.timeIn;
            row.insertCell().textContent = entry.timeOut;
            row.insertCell().textContent = entry.breakTime;
            row.insertCell().textContent = entry.otMultiplier;
            row.insertCell().textContent = result.workingHours;
            row.insertCell().textContent = result.totalEarnings;
            
            // ‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
            const actionCell = row.insertCell();
            actionCell.innerHTML = `
                <button class="btn-action btn-edit" onclick="editEntry(${entry.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button class="btn-action btn-delete" onclick="deleteEntry(${entry.id})">‡∏•‡∏ö</button>
            `;
        });
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 5: ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ---
    function deleteEntry(id) {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
            timeEntries = timeEntries.filter(entry => entry.id !== id);
            renderTable();
        }
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 6: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢) ---
    function editEntry(id) {
        const entry = timeEntries.find(e => e.id === id);
        if (!entry) return;

        // ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        const newDate = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (${entry.date}):`, entry.date);
        const newTimeIn = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ (${entry.timeIn}):`, entry.timeIn);
        const newTimeOut = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å (${entry.timeOut}):`, entry.timeOut);
        
        if (newDate && newTimeIn && newTimeOut) {
            entry.date = newDate;
            entry.timeIn = newTimeIn;
            entry.timeOut = newTimeOut;
            // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç BreakTime, Rate, OT ‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            renderTable();
        }
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 7: Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV ---
    function exportToCSV() {
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // \uFEFF ‡∏Ñ‡∏∑‡∏≠ BOM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢

        // ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        let header = ["‡∏•‡∏≥‡∏î‡∏±‡∏ö", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤", "‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å", "OT (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì)", "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)"];
        csvContent += header.join(",") + "\n";

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        timeEntries.forEach((entry, index) => {
            const result = calculateEarnings(entry);
            let row = [
                index + 1,
                entry.date,
                entry.timeIn,
                entry.timeOut,
                entry.otMultiplier,
                result.totalEarnings
            ];
            csvContent += row.join(",") + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "time_log_" + new Date().toISOString().slice(0, 10) + ".csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
